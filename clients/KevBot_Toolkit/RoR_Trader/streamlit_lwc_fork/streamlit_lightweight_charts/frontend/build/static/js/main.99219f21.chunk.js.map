{"version":3,"sources":["plugins/BandIndicator.ts","plugins/Rectangle.ts","plugins/SessionHighlighting.ts","plugins/AnchoredText.ts","LightweightCharts.tsx","index.tsx"],"names":["BandIndicatorRenderer","constructor","upperCoords","lowerCoords","fillColor","_upperCoords","_lowerCoords","_fillColor","this","draw","target","length","useMediaCoordinateSpace","scope","ctx","context","beginPath","moveTo","x","y","i","lineTo","j","closePath","fillStyle","fill","BandIndicatorPaneView","source","_source","zOrder","renderer","buildRenderer","BandIndicator","options","_options","_chart","_series","_paneViews","attached","param","chart","series","detached","updateAllViews","paneViews","timeScale","data","point","timeToCoordinate","time","yUpper","priceToCoordinate","upperValue","yLower","lowerValue","push","RectangleRenderer","x1","y1","x2","y2","borderColor","borderWidth","_x1","_y1","_x2","_y2","_borderColor","_borderWidth","Math","min","w","abs","h","fillRect","strokeStyle","lineWidth","strokeRect","RectanglePaneView","Rectangle","point1","price","point2","SessionHighlightingRenderer","bands","_bands","_target","drawBackground","height","mediaSize","band","color","SessionHighlightingPaneView","SessionHighlighting","ranges","range","startTime","endTime","AnchoredTextRenderer","text","fontSize","position","_x","_y","_text","_color","_fontSize","_position","font","textBaseline","drawX","drawY","textAlign","fillText","AnchoredTextPaneView","AnchoredText","LightweightChartsMultiplePanes","chartsData","useRenderData","args","chartsContainerRef","useRef","chartElRefs","Array","chartRefs","useEffect","find","ref","current","forEach","createChart","_objectSpread","width","clientWidth","createdSeries","chartSeries","type","addAreaSeries","addBarSeries","addBaselineSeries","addCandlestickSeries","addHistogramSeries","addLineSeries","priceScale","priceScaleId","applyOptions","setData","markers","setMarkers","priceLines","pl","createPriceLine","primitives","prim","targetSeries","seriesIndex","attachPrimitive","console","warn","concat","err","error","fitContent","charts","map","c","subscribeVisibleTimeRangeChange","e","filter","rightOffset","scrollPosition","subscribeVisibleLogicalRangeChange","setVisibleLogicalRange","from","to","remove","React","createElement","id","key","ReactDOM","render","StrictMode","StreamlitProvider","LightweightCharts","document","getElementById"],"mappings":"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","file":"static/js/main.99219f21.chunk.js","sourcesContent":["import {\r\n  ISeriesPrimitivePaneView,\r\n  ISeriesPrimitivePaneRenderer,\r\n  SeriesAttachedParameter,\r\n  Time,\r\n  SeriesType,\r\n  IChartApiBase,\r\n  ISeriesApi,\r\n  SeriesPrimitivePaneViewZOrder,\r\n} from \"lightweight-charts\";\r\nimport { CanvasRenderingTarget2D, MediaCoordinatesRenderingScope } from \"fancy-canvas\";\r\n\r\ninterface BandDataPoint {\r\n  time: Time;\r\n  upperValue: number;\r\n  lowerValue: number;\r\n}\r\n\r\ninterface BandIndicatorOptions {\r\n  fillColor: string;\r\n  data: BandDataPoint[];\r\n}\r\n\r\ninterface CoordPoint {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nclass BandIndicatorRenderer implements ISeriesPrimitivePaneRenderer {\r\n  private _upperCoords: CoordPoint[];\r\n  private _lowerCoords: CoordPoint[];\r\n  private _fillColor: string;\r\n\r\n  constructor(upperCoords: CoordPoint[], lowerCoords: CoordPoint[], fillColor: string) {\r\n    this._upperCoords = upperCoords;\r\n    this._lowerCoords = lowerCoords;\r\n    this._fillColor = fillColor;\r\n  }\r\n\r\n  draw(target: CanvasRenderingTarget2D): void {\r\n    if (this._upperCoords.length < 2) { return; }\r\n\r\n    var upperCoords = this._upperCoords;\r\n    var lowerCoords = this._lowerCoords;\r\n    var fillColor = this._fillColor;\r\n\r\n    target.useMediaCoordinateSpace((scope: MediaCoordinatesRenderingScope) => {\r\n      var ctx = scope.context;\r\n      ctx.beginPath();\r\n\r\n      // Draw upper curve left-to-right\r\n      ctx.moveTo(upperCoords[0].x, upperCoords[0].y);\r\n      for (var i = 1; i < upperCoords.length; i++) {\r\n        ctx.lineTo(upperCoords[i].x, upperCoords[i].y);\r\n      }\r\n\r\n      // Draw lower curve right-to-left (close the polygon)\r\n      for (var j = lowerCoords.length - 1; j >= 0; j--) {\r\n        ctx.lineTo(lowerCoords[j].x, lowerCoords[j].y);\r\n      }\r\n\r\n      ctx.closePath();\r\n      ctx.fillStyle = fillColor;\r\n      ctx.fill();\r\n    });\r\n  }\r\n}\r\n\r\nclass BandIndicatorPaneView implements ISeriesPrimitivePaneView {\r\n  private _source: BandIndicator;\r\n\r\n  constructor(source: BandIndicator) {\r\n    this._source = source;\r\n  }\r\n\r\n  zOrder(): SeriesPrimitivePaneViewZOrder {\r\n    return \"bottom\";\r\n  }\r\n\r\n  renderer(): ISeriesPrimitivePaneRenderer | null {\r\n    return this._source.buildRenderer();\r\n  }\r\n}\r\n\r\nexport class BandIndicator {\r\n  private _options: BandIndicatorOptions;\r\n  private _chart: IChartApiBase<Time> | null;\r\n  private _series: ISeriesApi<SeriesType, Time> | null;\r\n  private _paneViews: BandIndicatorPaneView[];\r\n\r\n  constructor(options: BandIndicatorOptions) {\r\n    this._options = options;\r\n    this._chart = null;\r\n    this._series = null;\r\n    this._paneViews = [new BandIndicatorPaneView(this)];\r\n  }\r\n\r\n  attached(param: SeriesAttachedParameter<Time, SeriesType>): void {\r\n    this._chart = param.chart;\r\n    this._series = param.series;\r\n  }\r\n\r\n  detached(): void {\r\n    this._chart = null;\r\n    this._series = null;\r\n  }\r\n\r\n  updateAllViews(): void {}\r\n\r\n  paneViews(): readonly ISeriesPrimitivePaneView[] {\r\n    return this._paneViews;\r\n  }\r\n\r\n  buildRenderer(): ISeriesPrimitivePaneRenderer | null {\r\n    if (!this._chart || !this._series) { return null; }\r\n\r\n    var timeScale = this._chart.timeScale();\r\n    var series = this._series;\r\n    var upperCoords: CoordPoint[] = [];\r\n    var lowerCoords: CoordPoint[] = [];\r\n\r\n    for (var i = 0; i < this._options.data.length; i++) {\r\n      var point = this._options.data[i];\r\n      var x = timeScale.timeToCoordinate(point.time);\r\n      var yUpper = series.priceToCoordinate(point.upperValue);\r\n      var yLower = series.priceToCoordinate(point.lowerValue);\r\n\r\n      if (x !== null && yUpper !== null && yLower !== null) {\r\n        upperCoords.push({ x: x as unknown as number, y: yUpper as unknown as number });\r\n        lowerCoords.push({ x: x as unknown as number, y: yLower as unknown as number });\r\n      }\r\n    }\r\n\r\n    if (upperCoords.length < 2) { return null; }\r\n\r\n    return new BandIndicatorRenderer(upperCoords, lowerCoords, this._options.fillColor);\r\n  }\r\n}\r\n","import {\r\n  ISeriesPrimitivePaneView,\r\n  ISeriesPrimitivePaneRenderer,\r\n  SeriesAttachedParameter,\r\n  Time,\r\n  SeriesType,\r\n  IChartApiBase,\r\n  ISeriesApi,\r\n  SeriesPrimitivePaneViewZOrder,\r\n} from \"lightweight-charts\";\r\nimport { CanvasRenderingTarget2D, MediaCoordinatesRenderingScope } from \"fancy-canvas\";\r\n\r\ninterface RectanglePoint {\r\n  time: Time;\r\n  price: number;\r\n}\r\n\r\ninterface RectangleOptions {\r\n  point1: RectanglePoint;\r\n  point2: RectanglePoint;\r\n  fillColor: string;\r\n  borderColor?: string;\r\n  borderWidth?: number;\r\n}\r\n\r\nclass RectangleRenderer implements ISeriesPrimitivePaneRenderer {\r\n  private _x1: number;\r\n  private _y1: number;\r\n  private _x2: number;\r\n  private _y2: number;\r\n  private _fillColor: string;\r\n  private _borderColor: string;\r\n  private _borderWidth: number;\r\n\r\n  constructor(\r\n    x1: number, y1: number, x2: number, y2: number,\r\n    fillColor: string, borderColor: string, borderWidth: number\r\n  ) {\r\n    this._x1 = x1;\r\n    this._y1 = y1;\r\n    this._x2 = x2;\r\n    this._y2 = y2;\r\n    this._fillColor = fillColor;\r\n    this._borderColor = borderColor;\r\n    this._borderWidth = borderWidth;\r\n  }\r\n\r\n  draw(target: CanvasRenderingTarget2D): void {\r\n    var x1 = this._x1;\r\n    var y1 = this._y1;\r\n    var x2 = this._x2;\r\n    var y2 = this._y2;\r\n    var fillColor = this._fillColor;\r\n    var borderColor = this._borderColor;\r\n    var borderWidth = this._borderWidth;\r\n\r\n    target.useMediaCoordinateSpace((scope: MediaCoordinatesRenderingScope) => {\r\n      var ctx = scope.context;\r\n      var x = Math.min(x1, x2);\r\n      var y = Math.min(y1, y2);\r\n      var w = Math.abs(x2 - x1);\r\n      var h = Math.abs(y2 - y1);\r\n\r\n      ctx.fillStyle = fillColor;\r\n      ctx.fillRect(x, y, w, h);\r\n\r\n      if (borderWidth > 0) {\r\n        ctx.strokeStyle = borderColor;\r\n        ctx.lineWidth = borderWidth;\r\n        ctx.strokeRect(x, y, w, h);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nclass RectanglePaneView implements ISeriesPrimitivePaneView {\r\n  private _source: Rectangle;\r\n\r\n  constructor(source: Rectangle) {\r\n    this._source = source;\r\n  }\r\n\r\n  zOrder(): SeriesPrimitivePaneViewZOrder {\r\n    return \"bottom\";\r\n  }\r\n\r\n  renderer(): ISeriesPrimitivePaneRenderer | null {\r\n    return this._source.buildRenderer();\r\n  }\r\n}\r\n\r\nexport class Rectangle {\r\n  private _options: RectangleOptions;\r\n  private _chart: IChartApiBase<Time> | null;\r\n  private _series: ISeriesApi<SeriesType, Time> | null;\r\n  private _paneViews: RectanglePaneView[];\r\n\r\n  constructor(options: RectangleOptions) {\r\n    this._options = options;\r\n    this._chart = null;\r\n    this._series = null;\r\n    this._paneViews = [new RectanglePaneView(this)];\r\n  }\r\n\r\n  attached(param: SeriesAttachedParameter<Time, SeriesType>): void {\r\n    this._chart = param.chart;\r\n    this._series = param.series;\r\n  }\r\n\r\n  detached(): void {\r\n    this._chart = null;\r\n    this._series = null;\r\n  }\r\n\r\n  updateAllViews(): void {}\r\n\r\n  paneViews(): readonly ISeriesPrimitivePaneView[] {\r\n    return this._paneViews;\r\n  }\r\n\r\n  buildRenderer(): ISeriesPrimitivePaneRenderer | null {\r\n    if (!this._chart || !this._series) { return null; }\r\n\r\n    var timeScale = this._chart.timeScale();\r\n    var x1 = timeScale.timeToCoordinate(this._options.point1.time);\r\n    var y1 = this._series.priceToCoordinate(this._options.point1.price);\r\n    var x2 = timeScale.timeToCoordinate(this._options.point2.time);\r\n    var y2 = this._series.priceToCoordinate(this._options.point2.price);\r\n\r\n    if (x1 === null || y1 === null || x2 === null || y2 === null) { return null; }\r\n\r\n    return new RectangleRenderer(\r\n      x1 as unknown as number,\r\n      y1 as unknown as number,\r\n      x2 as unknown as number,\r\n      y2 as unknown as number,\r\n      this._options.fillColor,\r\n      this._options.borderColor || \"transparent\",\r\n      this._options.borderWidth || 0\r\n    );\r\n  }\r\n}\r\n","import {\r\n  ISeriesPrimitivePaneView,\r\n  ISeriesPrimitivePaneRenderer,\r\n  SeriesAttachedParameter,\r\n  Time,\r\n  SeriesType,\r\n  IChartApiBase,\r\n  ISeriesApi,\r\n  SeriesPrimitivePaneViewZOrder,\r\n} from \"lightweight-charts\";\r\nimport { CanvasRenderingTarget2D, MediaCoordinatesRenderingScope } from \"fancy-canvas\";\r\n\r\ninterface SessionRange {\r\n  startTime: Time;\r\n  endTime: Time;\r\n  color: string;\r\n}\r\n\r\ninterface SessionHighlightingOptions {\r\n  ranges: SessionRange[];\r\n}\r\n\r\ninterface ComputedBand {\r\n  x1: number;\r\n  x2: number;\r\n  color: string;\r\n}\r\n\r\nclass SessionHighlightingRenderer implements ISeriesPrimitivePaneRenderer {\r\n  private _bands: ComputedBand[];\r\n\r\n  constructor(bands: ComputedBand[]) {\r\n    this._bands = bands;\r\n  }\r\n\r\n  draw(_target: CanvasRenderingTarget2D): void {\r\n    // all drawing in drawBackground\r\n  }\r\n\r\n  drawBackground(target: CanvasRenderingTarget2D): void {\r\n    var bands = this._bands;\r\n\r\n    target.useMediaCoordinateSpace((scope: MediaCoordinatesRenderingScope) => {\r\n      var ctx = scope.context;\r\n      var height = scope.mediaSize.height;\r\n\r\n      for (var i = 0; i < bands.length; i++) {\r\n        var band = bands[i];\r\n        ctx.fillStyle = band.color;\r\n        ctx.fillRect(band.x1, 0, band.x2 - band.x1, height);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nclass SessionHighlightingPaneView implements ISeriesPrimitivePaneView {\r\n  private _source: SessionHighlighting;\r\n\r\n  constructor(source: SessionHighlighting) {\r\n    this._source = source;\r\n  }\r\n\r\n  zOrder(): SeriesPrimitivePaneViewZOrder {\r\n    return \"bottom\";\r\n  }\r\n\r\n  renderer(): ISeriesPrimitivePaneRenderer | null {\r\n    return this._source.buildRenderer();\r\n  }\r\n}\r\n\r\nexport class SessionHighlighting {\r\n  private _options: SessionHighlightingOptions;\r\n  private _chart: IChartApiBase<Time> | null;\r\n  private _series: ISeriesApi<SeriesType, Time> | null;\r\n  private _paneViews: SessionHighlightingPaneView[];\r\n\r\n  constructor(options: SessionHighlightingOptions) {\r\n    this._options = options;\r\n    this._chart = null;\r\n    this._series = null;\r\n    this._paneViews = [new SessionHighlightingPaneView(this)];\r\n  }\r\n\r\n  attached(param: SeriesAttachedParameter<Time, SeriesType>): void {\r\n    this._chart = param.chart;\r\n    this._series = param.series;\r\n  }\r\n\r\n  detached(): void {\r\n    this._chart = null;\r\n    this._series = null;\r\n  }\r\n\r\n  updateAllViews(): void {}\r\n\r\n  paneViews(): readonly ISeriesPrimitivePaneView[] {\r\n    return this._paneViews;\r\n  }\r\n\r\n  buildRenderer(): ISeriesPrimitivePaneRenderer | null {\r\n    if (!this._chart) { return null; }\r\n\r\n    var timeScale = this._chart.timeScale();\r\n    var bands: ComputedBand[] = [];\r\n\r\n    for (var i = 0; i < this._options.ranges.length; i++) {\r\n      var range = this._options.ranges[i];\r\n      var x1 = timeScale.timeToCoordinate(range.startTime);\r\n      var x2 = timeScale.timeToCoordinate(range.endTime);\r\n\r\n      if (x1 !== null && x2 !== null) {\r\n        bands.push({\r\n          x1: x1 as unknown as number,\r\n          x2: x2 as unknown as number,\r\n          color: range.color,\r\n        });\r\n      }\r\n    }\r\n\r\n    if (bands.length === 0) { return null; }\r\n\r\n    return new SessionHighlightingRenderer(bands);\r\n  }\r\n}\r\n","import {\r\n  ISeriesPrimitivePaneView,\r\n  ISeriesPrimitivePaneRenderer,\r\n  SeriesAttachedParameter,\r\n  Time,\r\n  SeriesType,\r\n  IChartApiBase,\r\n  ISeriesApi,\r\n  SeriesPrimitivePaneViewZOrder,\r\n} from \"lightweight-charts\";\r\nimport { CanvasRenderingTarget2D, MediaCoordinatesRenderingScope } from \"fancy-canvas\";\r\n\r\ninterface AnchoredTextOptions {\r\n  time: Time;\r\n  price: number;\r\n  text: string;\r\n  color?: string;\r\n  fontSize?: number;\r\n  position?: string; // \"above\" | \"below\" | \"left\" | \"right\"\r\n}\r\n\r\nclass AnchoredTextRenderer implements ISeriesPrimitivePaneRenderer {\r\n  private _x: number;\r\n  private _y: number;\r\n  private _text: string;\r\n  private _color: string;\r\n  private _fontSize: number;\r\n  private _position: string;\r\n\r\n  constructor(x: number, y: number, text: string, color: string, fontSize: number, position: string) {\r\n    this._x = x;\r\n    this._y = y;\r\n    this._text = text;\r\n    this._color = color;\r\n    this._fontSize = fontSize;\r\n    this._position = position;\r\n  }\r\n\r\n  draw(target: CanvasRenderingTarget2D): void {\r\n    var x = this._x;\r\n    var y = this._y;\r\n    var text = this._text;\r\n    var color = this._color;\r\n    var fontSize = this._fontSize;\r\n    var position = this._position;\r\n\r\n    target.useMediaCoordinateSpace((scope: MediaCoordinatesRenderingScope) => {\r\n      var ctx = scope.context;\r\n      ctx.font = fontSize + \"px sans-serif\";\r\n      ctx.fillStyle = color;\r\n      ctx.textBaseline = \"middle\";\r\n\r\n      var drawX = x;\r\n      var drawY = y;\r\n      var padding = 4;\r\n\r\n      switch (position) {\r\n        case \"above\":\r\n          ctx.textAlign = \"center\";\r\n          drawY -= padding + fontSize / 2;\r\n          break;\r\n        case \"below\":\r\n          ctx.textAlign = \"center\";\r\n          drawY += padding + fontSize / 2;\r\n          break;\r\n        case \"left\":\r\n          ctx.textAlign = \"right\";\r\n          drawX -= padding;\r\n          break;\r\n        case \"right\":\r\n          ctx.textAlign = \"left\";\r\n          drawX += padding;\r\n          break;\r\n        default:\r\n          ctx.textAlign = \"center\";\r\n          drawY -= padding + fontSize / 2;\r\n      }\r\n\r\n      ctx.fillText(text, drawX, drawY);\r\n    });\r\n  }\r\n}\r\n\r\nclass AnchoredTextPaneView implements ISeriesPrimitivePaneView {\r\n  private _source: AnchoredText;\r\n\r\n  constructor(source: AnchoredText) {\r\n    this._source = source;\r\n  }\r\n\r\n  zOrder(): SeriesPrimitivePaneViewZOrder {\r\n    return \"top\";\r\n  }\r\n\r\n  renderer(): ISeriesPrimitivePaneRenderer | null {\r\n    return this._source.buildRenderer();\r\n  }\r\n}\r\n\r\nexport class AnchoredText {\r\n  private _options: AnchoredTextOptions;\r\n  private _chart: IChartApiBase<Time> | null;\r\n  private _series: ISeriesApi<SeriesType, Time> | null;\r\n  private _paneViews: AnchoredTextPaneView[];\r\n\r\n  constructor(options: AnchoredTextOptions) {\r\n    this._options = options;\r\n    this._chart = null;\r\n    this._series = null;\r\n    this._paneViews = [new AnchoredTextPaneView(this)];\r\n  }\r\n\r\n  attached(param: SeriesAttachedParameter<Time, SeriesType>): void {\r\n    this._chart = param.chart;\r\n    this._series = param.series;\r\n  }\r\n\r\n  detached(): void {\r\n    this._chart = null;\r\n    this._series = null;\r\n  }\r\n\r\n  updateAllViews(): void {\r\n    // coordinates recalculated in buildRenderer\r\n  }\r\n\r\n  paneViews(): readonly ISeriesPrimitivePaneView[] {\r\n    return this._paneViews;\r\n  }\r\n\r\n  buildRenderer(): ISeriesPrimitivePaneRenderer | null {\r\n    if (!this._chart || !this._series) { return null; }\r\n\r\n    var x = this._chart.timeScale().timeToCoordinate(this._options.time);\r\n    var y = this._series.priceToCoordinate(this._options.price);\r\n\r\n    if (x === null || y === null) { return null; }\r\n\r\n    return new AnchoredTextRenderer(\r\n      x as unknown as number,\r\n      y as unknown as number,\r\n      this._options.text,\r\n      this._options.color || \"#ffffff\",\r\n      this._options.fontSize || 12,\r\n      this._options.position || \"above\"\r\n    );\r\n  }\r\n}\r\n","import { useRenderData } from \"streamlit-component-lib-react-hooks\"\nimport {\n  createChart,\n  IChartApi,\n  ISeriesApi,\n  SeriesType,\n} from \"lightweight-charts\"\nimport React, { useRef, useEffect } from \"react\"\nimport { BandIndicator } from \"./plugins/BandIndicator\"\nimport { Rectangle } from \"./plugins/Rectangle\"\nimport { SessionHighlighting } from \"./plugins/SessionHighlighting\"\nimport { AnchoredText } from \"./plugins/AnchoredText\"\n\nconst LightweightChartsMultiplePanes: React.VFC = () => {\n\n  // returns the renderData passed from Python\n  // { args: object, disabled: boolean, theme: object }\n  const renderData = useRenderData()\n  const chartsData = renderData.args[\"charts\"]\n\n  const chartsContainerRef = useRef<HTMLDivElement>(null)\n  const chartElRefs = Array(chartsData.length).fill(useRef<HTMLDivElement>(null))\n  const chartRefs = useRef<IChartApi[]>([])\n\n    useEffect(() => {\n      if (chartElRefs.find((ref) => !ref.current)) return;\n\n      chartElRefs.forEach((ref, i) => {\n        const chart = chartRefs.current[i] = createChart(\n          ref.current as HTMLDivElement,{\n            height: 300,\n            width: chartElRefs[i].current.clientWidth,\n            ...chartsData[i].chart,\n          }\n        );\n\n        // Track created series for primitives that reference by index\n        const createdSeries: ISeriesApi<SeriesType>[] = [];\n\n        for (const series of chartsData[i].series){\n\n          let chartSeries: ISeriesApi<SeriesType> | undefined\n          switch(series.type) {\n            case 'Area':\n              chartSeries = chart.addAreaSeries(series.options)\n              break\n            case 'Bar':\n              chartSeries = chart.addBarSeries(series.options )\n              break\n            case 'Baseline':\n              chartSeries = chart.addBaselineSeries(series.options)\n              break\n            case 'Candlestick':\n              chartSeries = chart.addCandlestickSeries(series.options)\n              break\n            case 'Histogram':\n              chartSeries = chart.addHistogramSeries(series.options)\n              break\n            case 'Line':\n              chartSeries = chart.addLineSeries(series.options)\n              break\n            default:\n                return\n          }\n\n          if(series.priceScale)\n            chart.priceScale(series.options.priceScaleId || '').applyOptions(series.priceScale)\n\n          chartSeries.setData(series.data)\n\n          if(series.markers)\n            chartSeries.setMarkers(series.markers)\n\n          // B3: createPriceLine() support\n          if(series.priceLines) {\n            for (const pl of series.priceLines) {\n              chartSeries.createPriceLine(pl)\n            }\n          }\n\n          createdSeries.push(chartSeries)\n        }\n\n        // B4: Primitives dispatcher — attach custom drawing plugins to series\n        // Each primitive in the array specifies:\n        //   type: string — plugin type identifier\n        //   seriesIndex: number — which series to attach to (index into createdSeries)\n        //   options: object — plugin-specific configuration\n        if (chartsData[i].primitives) {\n          for (const prim of chartsData[i].primitives) {\n            const targetSeries = createdSeries[prim.seriesIndex || 0]\n            if (!targetSeries) continue\n\n            try {\n              switch (prim.type) {\n                case \"bandFill\":\n                  targetSeries.attachPrimitive(new BandIndicator(prim.options) as any)\n                  break\n                case \"rectangle\":\n                  targetSeries.attachPrimitive(new Rectangle(prim.options) as any)\n                  break\n                case \"sessionHighlight\":\n                  targetSeries.attachPrimitive(new SessionHighlighting(prim.options) as any)\n                  break\n                case \"anchoredText\":\n                  targetSeries.attachPrimitive(new AnchoredText(prim.options) as any)\n                  break\n                default:\n                  console.warn(`Unknown primitive type: ${prim.type}`)\n              }\n            } catch (err) {\n              console.error(`Error attaching primitive ${prim.type}:`, err)\n            }\n          }\n        }\n\n        chart.timeScale().fitContent();\n\n      })\n\n      const charts = chartRefs.current.map((c) => c as IChartApi);\n\n      if(chartsData.length > 1){ // sync charts\n        charts.forEach((chart) => {\n          if (!chart) return;\n\n          chart.timeScale().subscribeVisibleTimeRangeChange((e) => {\n            charts\n              .filter((c) => c !== chart)\n              .forEach((c) => {\n                c.timeScale().applyOptions({\n                  rightOffset: chart.timeScale().scrollPosition()\n          }) }) })\n\n          chart.timeScale().subscribeVisibleLogicalRangeChange((range) => {\n            if (range) {\n              charts\n                .filter((c) => c !== chart)\n                .forEach((c) => {\n                  c.timeScale().setVisibleLogicalRange({\n                    from: range?.from,\n                    to: range?.to\n          }) }) } })\n\n      }) }\n\n      return () => { // required because how useEffect() works\n        charts.forEach((chart) => {\n          chart.remove()\n        })\n      }\n\n    }, [ chartsData, chartElRefs, chartRefs])\n\n\n    return (\n      <div ref={chartsContainerRef}>\n        {chartElRefs.map((ref, i) => (\n          <div\n            ref={ref}\n            id={`lightweight-charts-${i}`}\n            key={`lightweight-charts-${i}`}\n          />\n        ))}\n      </div>\n    )\n\n}\n\nexport default LightweightChartsMultiplePanes\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport { StreamlitProvider } from \"streamlit-component-lib-react-hooks\"\nimport LightweightCharts from \"./LightweightCharts\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <StreamlitProvider>\n      <LightweightCharts />\n    </StreamlitProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}