{"version":3,"sources":["LightweightCharts.tsx","index.tsx"],"names":["LightweightChartsMultiplePanes","chartsData","useRenderData","args","chartsContainerRef","useRef","chartElRefs","Array","length","fill","chartRefs","useEffect","find","ref","current","forEach","i","chart","createChart","_objectSpread","height","width","clientWidth","createdSeries","series","chartSeries","type","addAreaSeries","options","addBarSeries","addBaselineSeries","addCandlestickSeries","addHistogramSeries","addLineSeries","priceScale","priceScaleId","applyOptions","setData","data","markers","setMarkers","priceLines","pl","createPriceLine","push","primitives","prim","seriesIndex","console","warn","concat","err","error","timeScale","fitContent","charts","map","c","subscribeVisibleTimeRangeChange","e","filter","rightOffset","scrollPosition","subscribeVisibleLogicalRangeChange","range","setVisibleLogicalRange","from","to","remove","React","createElement","id","key","ReactDOM","render","StrictMode","StreamlitProvider","LightweightCharts","document","getElementById"],"mappings":"iPA2JeA,MAlJmCA,KAIhD,MACMC,EADaC,0BACWC,KAAa,OAErCC,EAAqBC,iBAAuB,MAC5CC,EAAcC,MAAMN,EAAWO,QAAQC,KAAKJ,iBAAuB,OACnEK,EAAYL,iBAAoB,IA2HpC,OAzHAM,oBAAU,KACR,GAAIL,EAAYM,KAAMC,IAASA,EAAIC,SAAU,OAE7CR,EAAYS,QAAQ,CAACF,EAAKG,KACxB,MAAMC,EAAQP,EAAUI,QAAQE,GAAKE,YACnCL,EAAIC,QAAOK,YAAA,CACTC,OAAQ,IACRC,MAAOf,EAAYU,GAAGF,QAAQQ,aAC3BrB,EAAWe,GAAGC,QAKfM,EAA0C,GAEhD,IAAK,MAAMC,KAAUvB,EAAWe,GAAGQ,OAAO,CAExC,IAAIC,EACJ,OAAOD,EAAOE,MACZ,IAAK,OACHD,EAAcR,EAAMU,cAAcH,EAAOI,SACzC,MACF,IAAK,MACHH,EAAcR,EAAMY,aAAaL,EAAOI,SACxC,MACF,IAAK,WACHH,EAAcR,EAAMa,kBAAkBN,EAAOI,SAC7C,MACF,IAAK,cACHH,EAAcR,EAAMc,qBAAqBP,EAAOI,SAChD,MACF,IAAK,YACHH,EAAcR,EAAMe,mBAAmBR,EAAOI,SAC9C,MACF,IAAK,OACHH,EAAcR,EAAMgB,cAAcT,EAAOI,SACzC,MACF,QACI,OAYN,GATGJ,EAAOU,YACRjB,EAAMiB,WAAWV,EAAOI,QAAQO,cAAgB,IAAIC,aAAaZ,EAAOU,YAE1ET,EAAYY,QAAQb,EAAOc,MAExBd,EAAOe,SACRd,EAAYe,WAAWhB,EAAOe,SAG7Bf,EAAOiB,WACR,IAAK,MAAMC,KAAMlB,EAAOiB,WACtBhB,EAAYkB,gBAAgBD,GAIhCnB,EAAcqB,KAAKnB,GAQrB,GAAIxB,EAAWe,GAAG6B,WAChB,IAAK,MAAMC,KAAQ7C,EAAWe,GAAG6B,WAAY,CAE3C,GADqBtB,EAAcuB,EAAKC,aAAe,GAGvD,IACUD,EAAKpB,KAITsB,QAAQC,KAAK,2BAADC,OAA4BJ,EAAKpB,OAEjD,MAAOyB,GACPH,QAAQI,MAAM,6BAADF,OAA8BJ,EAAKpB,KAAI,KAAKyB,IAK/DlC,EAAMoC,YAAYC,eAIpB,MAAMC,EAAS7C,EAAUI,QAAQ0C,IAAKC,GAAMA,GA0B5C,OAxBGxD,EAAWO,OAAS,GACrB+C,EAAOxC,QAASE,IACTA,IAELA,EAAMoC,YAAYK,gCAAiCC,IACjDJ,EACGK,OAAQH,GAAMA,IAAMxC,GACpBF,QAAS0C,IACRA,EAAEJ,YAAYjB,aAAa,CACzByB,YAAa5C,EAAMoC,YAAYS,uBAGvC7C,EAAMoC,YAAYU,mCAAoCC,IAChDA,GACFT,EACGK,OAAQH,GAAMA,IAAMxC,GACpBF,QAAS0C,IACRA,EAAEJ,YAAYY,uBAAuB,CACnCC,KAAW,OAALF,QAAK,IAALA,OAAK,EAALA,EAAOE,KACbC,GAAS,OAALH,QAAK,IAALA,OAAK,EAALA,EAAOG,YAKlB,KACLZ,EAAOxC,QAASE,IACdA,EAAMmD,aAIT,CAAEnE,EAAYK,EAAaI,IAI5B2D,IAAAC,cAAA,OAAKzD,IAAKT,GACPE,EAAYkD,IAAI,CAAC3C,EAAKG,IACrBqD,IAAAC,cAAA,OACEzD,IAAKA,EACL0D,GAAE,sBAAArB,OAAwBlC,GAC1BwD,IAAG,sBAAAtB,OAAwBlC,QC9IvCyD,IAASC,OACPL,IAAAC,cAACD,IAAMM,WAAU,KACfN,IAAAC,cAACM,oBAAiB,KAChBP,IAAAC,cAACO,EAAiB,QAGtBC,SAASC,eAAe,W","file":"static/js/main.c6321a1a.chunk.js","sourcesContent":["import { useRenderData } from \"streamlit-component-lib-react-hooks\"\nimport {\n  createChart,\n  IChartApi,\n  ISeriesApi,\n  SeriesType,\n} from \"lightweight-charts\"\nimport React, { useRef, useEffect } from \"react\"\n\nconst LightweightChartsMultiplePanes: React.VFC = () => {\n\n  // returns the renderData passed from Python\n  // { args: object, disabled: boolean, theme: object }\n  const renderData = useRenderData()\n  const chartsData = renderData.args[\"charts\"]\n\n  const chartsContainerRef = useRef<HTMLDivElement>(null)\n  const chartElRefs = Array(chartsData.length).fill(useRef<HTMLDivElement>(null))\n  const chartRefs = useRef<IChartApi[]>([])\n\n    useEffect(() => {\n      if (chartElRefs.find((ref) => !ref.current)) return;\n\n      chartElRefs.forEach((ref, i) => {\n        const chart = chartRefs.current[i] = createChart(\n          ref.current as HTMLDivElement,{\n            height: 300,\n            width: chartElRefs[i].current.clientWidth,\n            ...chartsData[i].chart,\n          }\n        );\n\n        // Track created series for primitives that reference by index\n        const createdSeries: ISeriesApi<SeriesType>[] = [];\n\n        for (const series of chartsData[i].series){\n\n          let chartSeries: ISeriesApi<SeriesType> | undefined\n          switch(series.type) {\n            case 'Area':\n              chartSeries = chart.addAreaSeries(series.options)\n              break\n            case 'Bar':\n              chartSeries = chart.addBarSeries(series.options )\n              break\n            case 'Baseline':\n              chartSeries = chart.addBaselineSeries(series.options)\n              break\n            case 'Candlestick':\n              chartSeries = chart.addCandlestickSeries(series.options)\n              break\n            case 'Histogram':\n              chartSeries = chart.addHistogramSeries(series.options)\n              break\n            case 'Line':\n              chartSeries = chart.addLineSeries(series.options)\n              break\n            default:\n                return\n          }\n\n          if(series.priceScale)\n            chart.priceScale(series.options.priceScaleId || '').applyOptions(series.priceScale)\n\n          chartSeries.setData(series.data)\n\n          if(series.markers)\n            chartSeries.setMarkers(series.markers)\n\n          // B3: createPriceLine() support\n          if(series.priceLines) {\n            for (const pl of series.priceLines) {\n              chartSeries.createPriceLine(pl)\n            }\n          }\n\n          createdSeries.push(chartSeries)\n        }\n\n        // B4: Primitives dispatcher — attach custom drawing plugins to series\n        // Each primitive in the array specifies:\n        //   type: string — plugin type identifier\n        //   seriesIndex: number — which series to attach to (index into createdSeries)\n        //   options: object — plugin-specific configuration\n        if (chartsData[i].primitives) {\n          for (const prim of chartsData[i].primitives) {\n            const targetSeries = createdSeries[prim.seriesIndex || 0]\n            if (!targetSeries) continue\n\n            try {\n              switch (prim.type) {\n                // Plugin types will be registered here as they are implemented\n                // e.g., \"bandFill\", \"rectangle\", \"backgroundZone\", \"textAnnotation\"\n                default:\n                  console.warn(`Unknown primitive type: ${prim.type}`)\n              }\n            } catch (err) {\n              console.error(`Error attaching primitive ${prim.type}:`, err)\n            }\n          }\n        }\n\n        chart.timeScale().fitContent();\n\n      })\n\n      const charts = chartRefs.current.map((c) => c as IChartApi);\n\n      if(chartsData.length > 1){ // sync charts\n        charts.forEach((chart) => {\n          if (!chart) return;\n\n          chart.timeScale().subscribeVisibleTimeRangeChange((e) => {\n            charts\n              .filter((c) => c !== chart)\n              .forEach((c) => {\n                c.timeScale().applyOptions({\n                  rightOffset: chart.timeScale().scrollPosition()\n          }) }) })\n\n          chart.timeScale().subscribeVisibleLogicalRangeChange((range) => {\n            if (range) {\n              charts\n                .filter((c) => c !== chart)\n                .forEach((c) => {\n                  c.timeScale().setVisibleLogicalRange({\n                    from: range?.from,\n                    to: range?.to\n          }) }) } })\n\n      }) }\n\n      return () => { // required because how useEffect() works\n        charts.forEach((chart) => {\n          chart.remove()\n        })\n      }\n\n    }, [ chartsData, chartElRefs, chartRefs])\n\n\n    return (\n      <div ref={chartsContainerRef}>\n        {chartElRefs.map((ref, i) => (\n          <div\n            ref={ref}\n            id={`lightweight-charts-${i}`}\n            key={`lightweight-charts-${i}`}\n          />\n        ))}\n      </div>\n    )\n\n}\n\nexport default LightweightChartsMultiplePanes\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport { StreamlitProvider } from \"streamlit-component-lib-react-hooks\"\nimport LightweightCharts from \"./LightweightCharts\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <StreamlitProvider>\n      <LightweightCharts />\n    </StreamlitProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}